<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Gerador de Prompts — Método IA Operacional 30D</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header class="container header">
    <div class="brand">
      <div class="logo">IA</div>
      <div class="brand-text">
        <div class="brand-name">Gerador de Prompts</div>
        <div class="brand-sub">Copiar e colar • 30s</div>
      </div>
    </div>
    <a class="btn btn-ghost" href="/">Voltar</a>
  </header>

  <main class="container">
    <section class="section">
      <h1>Gere um prompt operacional (pronto pra usar)</h1>

      <div class="grid">
        <div class="box">
          <label>Tema</label>
          <input id="tema" class="input" placeholder="Ex: Criar vídeos TikTok com IA" />
          <label>Objetivo</label>
          <input id="objetivo" class="input" placeholder="Ex: Criar 30 roteiros curtos em 1 hora" />
          <label>Público</label>
          <input id="publico" class="input" placeholder="Ex: Iniciantes que querem criar conteúdo" />
          <label>Formato de saída</label>
          <input id="formato" class="input" placeholder="Ex: Lista de 30 roteiros + estrutura de hook" />

          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn btn-primary" id="btnGerar">Gerar prompt</button>
            <button class="btn btn-secondary" id="btnCopiar" disabled>Copiar</button>
          </div>

          <div class="mini-warning" style="margin-top:12px;">
            Sem promessas irreais. Prompt focado em execução.
          </div>
        </div>

        <div class="box">
          <h3>Resultado</h3>
          <pre id="saida" style="white-space:pre-wrap; margin:0; min-height:260px;"></pre>
        </div>
      </div>
    </section>
  </main>

  <script>
    const API_BASE = "https://nfse-backend-kn7i.onrender.com"; // seu backend Render
    const INTERNAL_API_KEY = "COLOQUE_UMA_CHAVE_AQUI_SÓ_PRA_TESTE_LOCAL"; 
    // depois: melhor carregar isso do backend/variável, ou proteger por sessão. (MVP ok)

    const $ = (id) => document.getElementById(id);
    const btnGerar = $("btnGerar");
    const btnCopiar = $("btnCopiar");
    const saida = $("saida");

    btnGerar.onclick = async () => {
      btnGerar.disabled = true;
      btnCopiar.disabled = true;
      saida.textContent = "Gerando...";

      const body = {
        tema: $("tema").value.trim(),
        objetivo: $("objetivo").value.trim(),
        publico: $("publico").value.trim(),
        formato: $("formato").value.trim(),
      };

      try {
        const r = await fetch(API_BASE + "/api/prompt", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + INTERNAL_API_KEY
          },
          body: JSON.stringify(body)
        });

        const data = await r.json();
        if (!r.ok) throw new Error(data?.error || "erro");

        saida.textContent = data.prompt || "(vazio)";
        btnCopiar.disabled = !data.prompt;
      } catch (e) {
        saida.textContent = "Erro ao gerar. Verifique campos e backend.";
      } finally {
        btnGerar.disabled = false;
      }
    };

    btnCopiar.onclick = async () => {
      await navigator.clipboard.writeText(saida.textContent);
      btnCopiar.textContent = "Copiado!";
      setTimeout(()=> btnCopiar.textContent = "Copiar", 1200);
    };
  </script>
</body>
</html>
